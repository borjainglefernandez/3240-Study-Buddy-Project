{% extends 'base.html' %}
{% load socialaccount %}


{% block content %}
<!--
If the user is authenticated then we do not have to log them in
-->
{% if user.is_authenticated %}
<p>You are logged in as {{ user.username }} </p>
<a href="{% provider_login_url 'google' %}">Sign into different account</a>
    <br>
<a href="groups/create">Create group</a>

<h2 class="mb-3">Available Study Groups: </h2>
<!--
Displays all the groups that have been created
-->
{% for group in groups_list %}
    <div class="row">
        <div class="col-md-9 col-sm-12">
            <!--
            Displays the group as a link and sends the group name as a parameter for the url
            -->
            <strong><a class = "mx-5" href="{% url 'studygroups:groupPage' group.name %}">{{ group }}</a></strong>


            <strong>  Capacity:</strong>
            {{group.maxSize}}

            <!--
            If user is part of group, display leave group button
            -->
            {% if user.student in group.get_members %}
                <form action="{% url 'studygroups:leaveGroup' %}" method="post">
                    {% csrf_token %}
                    <!--
                    Hidden input that has the id of the group that it sends to the appropriate function
                    -->
                    <input type="hidden" name="Group" id="Group" value={{group.id}}>
                    <button type="submit" class="btn btn-primary mx-7" name="edit">Leave Group</button>
                </form>

            <!--
            If user is not part of group, display join group button (if space available)
            -->
            {% else %}
                    <!--
                    If there is available space in the group display join group button
                    -->
                {% if group.get_members|length < group.maxSize %}
                <form action="{% url 'studygroups:joinGroup' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="Group" id="Group" value={{group.id}}>
                    <button type="submit" class="btn btn-primary mx-7" name="edit">Join Group</button>
                </form>

                <!--
                If no space left, say group is full
                -->
                {% else %}
                    <strong> Group Full </strong>
                {% endif %}

            {% endif %}
        </div>
    </div>
{% endfor %}


<!--
If the user is not authenticated then we have to log them in
before we can store any of their information
-->
{% else %}
    <h1>Login with Google to create an account!</h1>
    <a href="{% provider_login_url 'google' %}">Login with Google</a>
{% endif %}
{% endblock%}